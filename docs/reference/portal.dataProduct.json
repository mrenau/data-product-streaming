{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Cloud-scale Analytics Scenario - Data Product Streaming",
            "steps": [
                {
                    "name": "basics",
                    "label": "Data Product",
                    "elements": [
                        {
                            "name": "infoBoxDataManagementAnalytics",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Cloud-scale Analytics Scenario is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                "style": "Info",
                                "uri": "https://aka.ms/adopt/cloudscaleanalytics"
                            }
                        },
                        {
                            "name": "deploymentDetails",
                            "label": "Deployment Details",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentDetailsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscription and resource group as well as the location to specify the scope of your Data Product deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxPrerequisites",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Please make sure that you have a Data Management Landing Zone and Data Landing Zone deployed before deploying a Data Product or Data Integration template.",
                                        "style": "Warning",
                                        "uri": "https://github.com/Azure/data-management-zone"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Data Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "resourceGroupApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/resourcegroups?api-version=2020-01-01')]"
                                    }
                                },
                                {
                                    "name": "infoBoxResourceGroup",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We have already deployed a few resource groups in your Data Landing Zone, which can be used for Data Product and Data Integration Template deployments. They have the following names: '{prefix}-dp001', '{prefix}-dp002', '{prefix}-di001' and '{prefix}-di002'.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "resourceGroupId",
                                    "label": "Resource Group",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Resource Group for your Data Product.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.resourceGroupApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Subscription ID: ', last(take(split(item.id, '/'), 3)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, this deployment is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Data Product.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,australiaeast,centralindia,japaneast,southeastasia,southindia,canadacentral,francecentral,germanywestcentral,northeurope,uksouth,westeurope,brazilsouth,centralus,eastus,eastus2,southcentralus,westcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "dataProductName",
                            "label": "Data Product Name",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "dataPruductNamesText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify a prefix and select an environment (Development, Test, Production) which will both be used as a prefix for all resource names. Independent of the environment, the same resources get deployed.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment. This is currently only used for the naming of resources.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                },
                                {
                                    "name": "dataProductPrefix",
                                    "label": "Data Product Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "validations": [
                                            {
                                                "regex": "^[a-z0-9]{1,10}$",
                                                "message": "The prefix must be between 1-10 lowercase characters and numbers."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').dataProductName.eventHubNamespaceNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').dataProductName.iotHubNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').dataProductName.keyVaultNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').dataProductName.sqlServerNameApi.available, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').dataProductName.synapseNameApi.available, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "cosmosNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat('/providers/Microsoft.DocumentDB/databaseAccountNames/', steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-cosmos001', '?api-version=2021-04-15')]"
                                    }
                                },
                                {
                                    "name": "eventHubNamespaceNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.EventHub/checkNameAvailability?api-version=2017-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-eventhub001')]"
                                        }
                                    }
                                },
                                {
                                    "name": "iotHubNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Devices/checkNameAvailability?api-version=2018-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-iothub001')]"
                                        }
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-vault001')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "sqlServerNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Sql/checkNameAvailability?api-version=2021-02-01-preview')]",
                                        "body": {
                                            "name": "[concat(steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-sqlserver001')]",
                                            "type": "Microsoft.Sql/servers"
                                        }
                                    }
                                },
                                {
                                    "name": "synapseNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Synapse/checkNameAvailability?api-version=2021-03-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').dataProductName.dataProductPrefix, '-', steps('basics').dataProductName.environment, '-synapse001')]",
                                            "type": "Microsoft.Synapse/workspaces"
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "generalSettings",
                    "label": "General Settings",
                    "subLabel": {
                        "preValidation": "Provide settings for your data product deployment.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "General Settings",
                    "bladeSubtitle": "General Settings",
                    "elements": [
                        {
                            "name": "synapseDeploymentSettings",
                            "label": "Synapse Deployment Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "synapseDeploymentSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify settings for your Synapse workspace.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/en-us/azure/synapse-analytics/overview-what-is"
                                        }
                                    }
                                },
                                {
                                    "name": "administratorPassword",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "type": "Microsoft.Common.PasswordBox",
                                    "visible": true,
                                    "toolTip": "Specify an administrator password for the Synapse workspace.",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,128}$",
                                        "validationMessage": "The password must be alphanumeric, contain at least 8 characters, and have at least 1 letter, 1 number and one special character."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    }
                                },
                                {
                                    "name": "infoBoxSynapseDefaultStorageAccount",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We are recommending to use a dedicated container per Data Product in the workspace Data Lake and per Data Integration in the Raw as well as Enriched & Curated Data Lake. Please select the respective Data Lake in your Data Landing Zone (e.g. Raw - '{prefix}{environment}raw', Enriched & Curated - '{prefix}{environment}encur', Workspace - '{prefix}{environment}work') and select one of the pre-existing storage account containers (e.g. 'di001', 'di002', 'dp001', 'dp002') or create and select a new one for this deployment if all of them are already in use.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/storageAccounts?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountId",
                                    "label": "Storage Account",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Storage account to which you want to connect Synapse.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountApi.value,(item) => and(equals(item.location, steps('basics').deploymentDetails.locationName), equals(item.properties.isHnsEnabled, true))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountId, '/blobServices/default/containers?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "synapseDefaultStorageAccountFileSystemId",
                                    "label": "Synapse Default Storage Account Container",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Default storage container for the Synapse workspace. If no option is shown, please make sure that a container exists within the storage account selected above.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "enableSqlPool",
                                    "label": "Enable SQL Pool",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of an Azure Synapse SQL Pool (DW100).",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable the deployment of an Azure Synapse SQL Pool (DW100)."
                                    }
                                },
                                {
                                    "name": "enableDataExplorerPool",
                                    "label": "Enable Data Explorer Pool",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of an Azure Data Explorer Pool (Compute optimized, Extra small).",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable the deployment of an Azure Data Explorer Pool (Compute optimized, Extra small)."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "streamAnalyticsDeploymentSettings",
                            "label": "Stream Analytics Deployment Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "streamAnalyticsDeploymentSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify settings for your Stream Analytics Job and Cluster.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-introduction"
                                        }
                                    }
                                },
                                {
                                    "name": "enableStreamAnalytics",
                                    "label": "Enable Azure Stream Analytics",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of Azure Stream Analytics Cluster and Job.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable the deployment of Azure Stream Analytics Cluster and Job."
                                    }
                                },
                                {
                                    "name": "infoBoxStreamAnalyticsDefaultStorageAccount",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": "[equals(steps('generalSettings').streamAnalyticsDeploymentSettings.enableStreamAnalytics, true)]",
                                    "options": {
                                        "text": "We are recommending to use a dedicated container per Data Product in the workspace Data Lake and per Data Integration in the Raw as well as Enriched & Curated Data Lake. Please select the respective Data Lake in your Data Landing Zone (e.g. Raw - '{prefix}{environment}raw', Enriched & Curated - '{prefix}{environment}encur', Workspace - '{prefix}{environment}work') and select one of the pre-existing storage account containers (e.g. 'di001', 'di002', 'dp001', 'dp002') or create and select a new one for this deployment if all of them are already in use.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "streamAnalyticsDefaultStorageAccountApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/storageAccounts?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "streamAnalyticsDefaultStorageAccountId",
                                    "label": "Storage Account",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').streamAnalyticsDeploymentSettings.enableStreamAnalytics, true)]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Storage account to which you want to connect the Stream Analytics Cluster.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('generalSettings').streamAnalyticsDeploymentSettings.streamAnalyticsDefaultStorageAccountApi.value,(item) => and(equals(item.location, steps('basics').deploymentDetails.locationName), equals(item.properties.isHnsEnabled, true))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "streamAnalyticsDefaultStorageAccountFileSystemApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').streamAnalyticsDeploymentSettings.streamAnalyticsDefaultStorageAccountId, '/blobServices/default/containers?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "streamanalyticsDefaultStorageAccountFileSystemId",
                                    "label": "Stream Analytics Default Storage Account Container",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('generalSettings').streamAnalyticsDeploymentSettings.enableStreamAnalytics, true)]",
                                    "defaultValue": "",
                                    "toolTip": "Default storage container for the Stream Analytics Cluster. If no option is shown, please make sure that a container exists within the storage account selected above.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('generalSettings').streamAnalyticsDeploymentSettings.streamAnalyticsDefaultStorageAccountFileSystemApi.value, (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "dataGovernanceSettings",
                            "label": "Data Governance Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "dataGovernanceSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Purview account to which you want to connect the Synapse workspace.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/en-us/azure/purview/overview"
                                        }
                                    }
                                },
                                {
                                    "name": "purviewId",
                                    "label": "Connect to Purview Account",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Purview account to which you want to connect the Synapse workspace.",
                                    "resourceType": "Microsoft.Purview/accounts",
                                    "required": true,
                                    "options": {
                                        "filter": {
                                            "subscription": "all",
                                            "location": "all"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "generalSettings",
                            "label": "Analytics Service Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "generalSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify general settings for other optional analytics services.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "enableSqlServer",
                                    "label": "Enable Azure SQL Server",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of Azure SQL Server.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable the deployment of Azure SQL Server."
                                    }
                                },
                                {
                                    "name": "enableCosmos",
                                    "label": "Enable Azure Cosmos DB",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of Azure Cosmos DB.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable the deployment of Azure Cosmos DB."
                                    }
                                },
                                {
                                    "name": "infoBoxRoleAssignment",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "The role assignment is optional and will assign the Stream Analytics Job MSI and Synapse MSI to the respective selected default Storage Account Container (Storage Blob Data Contributor).",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "enableRoleAssignments",
                                    "label": "Enable role assignments",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "defaultValue": "Yes (recommended)",
                                    "toolTip": "Enable role assignments.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "monitoringSettings",
                            "label": "Monitoring Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "monitoringSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify Monitoring settings for this deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "enableMonitoring",
                                    "label": "Deploy Monitoring Components",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "Deploy monitoring components like Log Analytics, Azure dashboards, alerts, and diagnostic settings.",
                                    "defaultValue": "Yes (recommended)",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Yes (recommended)",
                                                "value": "yes"
                                            },
                                            {
                                                "label": "No",
                                                "value": "no"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "dataProductTeamEmail",
                                    "label": "Alert Receivers Email ID",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": "[equals(steps('generalSettings').monitoringSettings.enableMonitoring, 'yes')]",
                                    "defaultValue": "",
                                    "toolTip": "Specify Email ID to receive monitoring alerts."
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity Settings",
                    "subLabel": {
                        "preValidation": "Provide the connectivity settings that should be used for the Data Product.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
                            "name": "virtualNetwork",
                            "label": "Virtual Network",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "virtualNetworkText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Virtual Network and Subnet for your deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxVirtualNetwork",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Please select the Virtual Network of your Data Landing Zone and select a free Subnet within the Virtual Network to make sure that you have proper outbound connectivity as well as DNS name resolution in place. The subnet must have 'privateEndpointNetworkPolicies' and 'privateLinkServiceNetworkPolicies' set to disabled. This is already pre-configured for you in the DataProduct and DataIntegration subnets in the Data Landing Zone Vnet.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "virtualNetworkApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Network/virtualNetworks?api-version=2020-11-01')]"
                                    }
                                },
                                {
                                    "name": "virtualNetworkId",
                                    "label": "Virtual Network",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Virtual Network for your Data Product.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').virtualNetwork.virtualNetworkApi.value,(item) => equals(item.location, steps('basics').deploymentDetails.locationName)),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "subnetApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('connectivitySettings').virtualNetwork.virtualNetworkId, '/subnets?api-version=2020-11-01')]"
                                    }
                                },
                                {
                                    "name": "subnetId",
                                    "label": "Subnet",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subnet for your Data Product. The subnet must have 'privateEndpointNetworkPolicies' and 'privateLinkServiceNetworkPolicies' set to disabled.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').virtualNetwork.subnetApi.value,(item) => and(equals(item.properties.privateEndpointNetworkPolicies, 'Disabled'), lessOrEquals(int(last(split(item.properties.addressPrefix, '/'))), 27))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "privateDnsZones",
                            "label": "Private DNS Zones",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "privateDnsZonesText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Private DNS Zone settings for your deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxPrivateDnsZone",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We are deploying all services with private endpoints and disabled public network access to reduce the data exfiltration risk. For each private endpoint, DNS A-records need to be created in a Private DNS Zones. Therefore, these either need to deployed through Azure Policies or you have to provide the Private DNS Zones that should be used for this deployment. We are assuming that all Private DNS Zones are created in the same subscription. Deploying DNS A-Records through Private Endpoints is the recommended solution.",
                                        "style": "Info",
                                        "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/private-link-and-dns-integration-at-scale"
                                    }
                                },
                                {
                                    "name": "automatedPrivateDnsZoneGroups",
                                    "label": "DNS A-Records are deployed through Azure Policy",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'Yes' is selected, Private DNS Zone Groups will not be deployed and we are assuming that this gets created through Azure Policies. If this does not get created, you will not be able to access any resources within this environment.",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "No",
                                                "value": "no"
                                            },
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "privateDnsZonesSub",
                                    "label": "Subscription with Private DNS Zones",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Private DNS Zones. If you have deployed the Data Management Landing Zone with a Firewall and Private DNS Zones then select the subscription that you have used for your Data Management Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('connectivitySettings').privateDnsZones.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZonesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('connectivitySettings').privateDnsZones.privateDnsZonesSub, '/providers/Microsoft.Network/privateDnsZones?api-version=2018-09-01')]"
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdKeyVault",
                                    "label": "Private DNS Zone Key Vault (privatelink.vaultcore.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Key Vault (privatelink.vaultcore.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.vaultcore.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseDev",
                                    "label": "Private DNS Zone Synapse Dev (privatelink.dev.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Dev (privatelink.dev.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.dev.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSynapseSql",
                                    "label": "Private DNS Zone Synapse Sql (privatelink.sql.azuresynapse.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Synapse Sql (privatelink.sql.azuresynapse.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.sql.azuresynapse.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdEventhubNamespace",
                                    "label": "Private DNS Zone EventHub Namespace (privatelink.servicebus.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for EventHub Namespace (privatelink.servicebus.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.servicebus.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdCosmosdbSql",
                                    "label": "Private DNS Zone Cosmos SQL (privatelink.documents.azure.com)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Cosmos SQL (privatelink.documents.azure.com).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.documents.azure.com')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdSqlServer",
                                    "label": "Private DNS Zone SQL Server (privatelink.database.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for SQL Server (privatelink.database.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.database.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdIothub",
                                    "label": "Private DNS Zone IoT Hub (privatelink.azure-devices.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for IoT Hub (privatelink.azure-devices.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.azure-devices.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "DataManagementAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "ResourceGroup",
            "location": "[steps('basics').deploymentDetails.locationName]",
            "resourceGroupId": "[steps('basics').deploymentDetails.resourceGroupId]",
            "parameters": {
                "location": "[if(empty(steps('basics').deploymentDetails.locationName), '', steps('basics').deploymentDetails.locationName)]",
                "environment": "[if(empty(steps('basics').dataProductName.environment), '', steps('basics').dataProductName.environment)]",
                "prefix": "[if(empty(steps('basics').dataProductName.dataProductPrefix), '', steps('basics').dataProductName.dataProductPrefix)]",
                "administratorPassword": "[if(empty(steps('generalSettings').synapseDeploymentSettings.administratorPassword), '', steps('generalSettings').synapseDeploymentSettings.administratorPassword)]",
                "synapseDefaultStorageAccountFileSystemId": "[if(empty(steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemId), '', steps('generalSettings').synapseDeploymentSettings.synapseDefaultStorageAccountFileSystemId)]",
                "enableSqlPool": "[steps('generalSettings').synapseDeploymentSettings.enableSqlPool]",
                "enableDataExplorerPool": "[steps('generalSettings').synapseDeploymentSettings.enableDataExplorerPool]",
                "enableSqlServer": "[steps('generalSettings').generalSettings.enableSqlServer]",
                "enableCosmos": "[steps('generalSettings').generalSettings.enableCosmos]",
                "enableStreamAnalytics": "[steps('generalSettings').streamAnalyticsDeploymentSettings.enableStreamAnalytics]",
                "enableMonitoring": "[equals(steps('generalSettings').monitoringSettings.enableMonitoring, 'yes')]",
                "dataProductTeamEmail": "[if(empty(steps('generalSettings').monitoringSettings.dataProductTeamEmail), '', steps('generalSettings').monitoringSettings.dataProductTeamEmail)]",
                "streamanalyticsDefaultStorageAccountFileSystemId": "[if(empty(steps('generalSettings').streamAnalyticsDeploymentSettings.streamanalyticsDefaultStorageAccountFileSystemId), '', steps('generalSettings').streamAnalyticsDeploymentSettings.streamanalyticsDefaultStorageAccountFileSystemId)]",
                "purviewId": "[if(empty(steps('generalSettings').dataGovernanceSettings.purviewId.id), '', steps('generalSettings').dataGovernanceSettings.purviewId.id)]",
                "enableRoleAssignments": "[equals(steps('generalSettings').generalSettings.enableRoleAssignments, 'yes')]",
                "subnetId": "[if(empty(steps('connectivitySettings').virtualNetwork.subnetId), '', steps('connectivitySettings').virtualNetwork.subnetId)]",
                "privateDnsZoneIdKeyVault": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault)]",
                "privateDnsZoneIdSynapseDev": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseDev)]",
                "privateDnsZoneIdSynapseSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSynapseSql)]",
                "privateDnsZoneIdEventhubNamespace": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdEventhubNamespace), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdEventhubNamespace)]",
                "privateDnsZoneIdCosmosdbSql": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCosmosdbSql), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdCosmosdbSql)]",
                "privateDnsZoneIdSqlServer": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSqlServer), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdSqlServer)]",
                "privateDnsZoneIdIothub": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdIothub), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdIothub)]",
                "tags": "[if(not(contains(steps('tags').tagsByResource, 'DataManagementAnalytics')), parse('{}'), first(map(parse(concat('[', string(steps('tags').tagsByResource), ']')), (item) => item.DataManagementAnalytics)))]"
            }
        }
    }
}